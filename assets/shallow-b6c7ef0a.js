import{R as h}from"./index-fa044d43.js";const z=()=>window.opener?[window.opener]:window.parent!==window?[window.parent]:[window],W=(t,e)=>(n,i,a)=>{var c;if(typeof window>"u")return t(n,i,a);const y=z();let m=i()!==void 0,u=!1;const f=(c=e==null?void 0:e.name)!=null?c:t.toString();let d=0;const o=[0],g=(r,s)=>{const{targetElementIFrameIds:l}=s??{};for(const w of document.querySelectorAll("iframe"))if(!l||l.includes(w.id))try{const{contentWindow:b,src:I}=w;b&&I&&b.postMessage(r,new URL(I).origin)}catch(b){console.error(`Failed to post message to iframe with id '${w.id}':`,b)}for(const w of y)try{w.postMessage(r,w.origin)}catch(b){console.error("Failed to post message to window:",b)}},S=()=>{let r=i();e!=null&&e.partialize&&(r=e.partialize(r)),e!=null&&e.skipSerialization||(r=JSON.parse(JSON.stringify(r))),g({name:f,action:"change",state:r})},M=(...r)=>{n(...r),!(e!=null&&e.unsync)&&S()},_=r=>{if(!r.data||typeof r.data!="object")return;const s=r.data;if(s.action==="sync"){if(!u)return;S();const l=o[o.length-1]+1;o.push(l),e==null||e.onTabsChange==null||e.onTabsChange(o),g({action:"add_new_tab",id:l});return}if(s.action==="add_new_tab"&&!u&&d===0){d=s.id;return}if(s.action==="change"&&(n(l=>e!=null&&e.merge?e.merge(l,s.state):s.state),m=!0),s.action==="close"&&u){const l=o.indexOf(s.id);l!==0&&(o.splice(l,1),e==null||e.onTabsChange==null||e.onTabsChange(o))}s.action==="change_main"&&s.id===d&&(u=!0,o.splice(0,o.length,...s.tabs),e==null||e.onBecomeMain==null||e.onBecomeMain(d))},E=()=>{var r;g({action:"sync"}),setTimeout(()=>{m||(u=!0,m=!0,e==null||e.onBecomeMain==null||e.onBecomeMain(d))},(r=e==null?void 0:e.mainTimeout)!=null?r:100)},C=()=>{if(g({action:"close",id:d}),u){if(o.length===1)return;const r=o.filter(s=>s!==d);g({action:"change_main",id:r[0],tabs:r})}};return typeof window<"u"&&(window.addEventListener("message",_,!1),window.addEventListener("beforeunload",C)),m||E(),a.setState=M,t(M,i,a)},F=W,O=t=>{let e;const n=new Set,i=(f,d)=>{const o=typeof f=="function"?f(e):f;if(!Object.is(o,e)){const g=e;e=d??(typeof o!="object"||o===null)?o:Object.assign({},e,o),n.forEach(S=>S(e,g))}},a=()=>e,m={setState:i,getState:a,getInitialState:()=>u,subscribe:f=>(n.add(f),()=>n.delete(f))},u=e=t(i,a,m);return m},R=t=>t?O(t):O,L=t=>t;function $(t,e=L){const n=h.useSyncExternalStore(t.subscribe,()=>e(t.getState()),()=>e(t.getInitialState()));return h.useDebugValue(n),n}const j=t=>{const e=R(t),n=i=>$(e,i);return Object.assign(n,e),n},k=t=>t?j(t):j,q=k()(F((t,e)=>({count:0,increment:()=>t(n=>({count:n.count+1})),decrement:()=>t({count:e().count-1}),mode:"Sync",setMode:n=>t({mode:n})}),{name:"my-store",targetOriginUrls:[window.origin],targetElementIFrameIds:["demo-iframe"]})),x=t=>Symbol.iterator in t,T=t=>"entries"in t,p=(t,e)=>{const n=t instanceof Map?t:new Map(t.entries()),i=e instanceof Map?e:new Map(e.entries());if(n.size!==i.size)return!1;for(const[a,c]of n)if(!Object.is(c,i.get(a)))return!1;return!0},J=(t,e)=>{const n=t[Symbol.iterator](),i=e[Symbol.iterator]();let a=n.next(),c=i.next();for(;!a.done&&!c.done;){if(!Object.is(a.value,c.value))return!1;a=n.next(),c=i.next()}return!!a.done&&!!c.done};function N(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:!x(t)||!x(e)?p({entries:()=>Object.entries(t)},{entries:()=>Object.entries(e)}):T(t)&&T(e)?p(t,e):J(t,e)}function D(t){const e=h.useRef(void 0);return n=>{const i=t(n);return N(e.current,i)?e.current:e.current=i}}export{D as a,q as u};
